!function(){function t(){BOOMTRAIN_API_KEY="",PARTNER_API_KEY=""}if(window._btn)return void window.console.log("Boomtrain library already loaded from previous session! Aborting...");window.console.log("Loading Boomtrain library"),VERSION="1.0.7",DEBUG_MODE=!0,AUTO_VIEW_TRACKING=!0,PARTNER_LIBRARY_LOCATION="https://d3r7h55ola878c.cloudfront.net/btn/"+VERSION+"/nudgespot-loader.js",BT_LOAD_STARTED=!1,PARTNER_LOAD_STARTED=!1,PARTNER_NAME="Nudgespot";var n=[],e={uid:"",dataFields:[],isSet:function(){return!(null==this.uid||0===this.uid.length)},clear:function(){this.uid="",this.dataFields=[]},isValidEmail:function(){var t=!1,n=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;return-1==this.uid.search(n)||(t=!0),t}},i=window.console,o={log:function(){if(DEBUG_MODE&&i)try{i.log.apply(i,arguments)}catch(t){_btn.each(arguments,function(t){i.log(t)})}},err:function(){if(DEBUG_MODE&&i)try{i.log.apply(i,arguments)}catch(t){_btn.each(arguments,function(t){i.log(t)})}}},r=Array.prototype,a=Object.prototype,u=r.slice,s=(a.toString,a.hasOwnProperty),d=r.forEach,c=(Array.isArray,Object.keys);t.prototype={clear:function(t){if(_btn.log("Clearing current user..."),_btn.setCookie("bt-uid","",0),e.clear(),window._bt)_bt.clear(t);else{_btn.log("Cleared.");var n=function(){};t=t||n,t()}},getCurrentUser:function(){return e},setDebugMode:function(t){DEBUG_MODE=t,_btn.log("Boomtrain ProjectN Version "+VERSION)},getCurrentStatus:function(){o.log("Current Boomtrain API Key: "+BOOMTRAIN_API_KEY),o.log("Current "+PARTNER_NAME+" API Key: "+PARTNER_API_KEY),e.isSet()?(o.log("Current user id: "+e.uid),o.log("Current user dataFields: "+JSON.Stringify(e.dataFields))):o.log("Initialized anonymously. No UID or email found.")},include:function(t,n){var e=document.getElementsByTagName("head")[0],i=document.createElement("script");i.src=t,i.type="text/javascript",i.onload=i.onreadystatechange=function(){i.readyState?("complete"===i.readyState||"loaded"===i.readyState)&&(i.onreadystatechange=null,n()):n()},e.appendChild(i)},setAPIKeys:function(t,n){BOOMTRAIN_API_KEY=t,PARTNER_API_KEY=n},setAutoTracking:function(t){AUTO_VIEW_TRACKING=t,_btn.log("Auto view tracking set to: "+AUTO_VIEW_TRACKING)},runQueuedCalls:function(){for(;n.length>0;)n.shift()(),_btn.log("Running queued function")},queueFunction:function(t,e,i,o){fnToQueue=function(){t.apply(e,i)},n.push(fnToQueue),_btn.log("Queued function");var r=function(){};(o=o||r)()},initialize:function(t,n,i){n&&""!=n||(n={}),t&&(t=t.toString()),BT_LOAD_STARTED?(_btn.log("Boomtrain already loaded."),t?(e.uid=t,_btn.log("User data passed as argument to Initialize().")):(_btn.log("Fetching user from cookie."),e.uid=_btn.getCookie("bt-uid")||_btn.getCookie("bt-email"),e.uid||_btn.log("No user found. Logging in anonymously.")),n&&(e.dataFields=n),e.isSet()&&(_btn.log("Setting up current user."),_btn.setupCurrentUser(e,function(){var t=function(){};(i=i||t)()}))):(BT_LOAD_STARTED=!0,_btn.include("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js",function(){_btn.log("UnderscoreJS loaded."),t?(e.uid=t,_btn.log("User data passed as argument to Initialize().")):(_btn.log("Fetching user from cookie."),e.uid=_btn.getCookie("bt-uid"),e.uid||_btn.log("No user found. Logging in anonymously.")),e.dataFields=n,_btn.include("https://cdn.boomtrain.com/analyticstrain/"+BOOMTRAIN_API_KEY+"/analyticstrain.min.js",function(){_btn.log("Boomtrain analytics loaded."),_btn.include(PARTNER_LIBRARY_LOCATION,function(){if(_btn.log(PARTNER_NAME+" analytics loaded."),nudgespot.init(PARTNER_API_KEY),e.isSet())_btn.setupCurrentUser(e,function(){var t=function(){};(i=i||t)()});else{_btn.runQueuedCalls();var t=function(){};i=i||t,i()}})})}))},setupCurrentUser:function(t,n){if(window._bt)_btn.setCookie("bt-uid",t.uid,365),btUserDataFields={},t.isValidEmail()?t.dataFields=_btn.extend({email:t.uid},t.dataFields):_bt.identify(t.uid),_bt.person.set(t.dataFields,function(){if(_btn.log("Boomtrain user identified: "+t.uid),PARTNER_LOAD_STARTED)_btn.log(PARTNER_NAME+" already loaded."),nudgespot.identify(t.uid,t.dataFields),o.log("Datafields"+JSON.stringify(t.dataFields)),btResourceDataFields={app:_bt.app,bsin:_bt.identity.props.bsin,app_member_id:_bt.identity.props.app_member_id,userId:_bt.identity.props.bsin||_bt.identity.props.app_member_id,session:_bt.session.id,url:window.location.href},nudgespot.track("nudgespot::page_view",btResourceDataFields,function(){_btn.log(PARTNER_NAME+" viewed event triggered."),_btn.runQueuedCalls();var t=function(){};(n=n||t)()});else if(PARTNER_LOAD_STARTED=!0,_btn.log(PARTNER_NAME+" analytics loaded."),nudgespot.init(PARTNER_API_KEY),nudgespot.identify(t.uid,t.dataFields),o.log("Datafields"+JSON.stringify(t.dataFields)),btResourceDataFields={app:_bt.app,bsin:_bt.identity.props.bsin,app_member_id:_bt.identity.props.app_member_id,userId:_bt.identity.props.bsin||_bt.identity.props.app_member_id,session:_bt.session.id,url:window.location.href},AUTO_VIEW_TRACKING)nudgespot.track("nudgespot::page_view",btResourceDataFields,function(){_btn.log(PARTNER_NAME+" viewed event triggered."),_btn.runQueuedCalls();var t=function(){};(n=n||t)()});else{_btn.runQueuedCalls();var e=function(){};n=n||e,n()}});else{this.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded! Queuing user setup."),_btn.queueFunction(_btn.setupCurrentUser,this,arguments);var e=function(){};n=n||e,n()}},getValue:function(t,n){return t.length&&t.hasOwnProperty(n)?t[n]:null},log:function(t){o.log(t)},err:function(t,n){o.log("Error: "+t+". "+n)},track:function(t,n,i){if(""==n&&(n={}),window._bt)_bt.track(t,n,function(){_btn.log("Boomtrain track event: "+t),window.nudgespot&&e.isSet()&&nudgespot.track(t,n,function(){_btn.log(PARTNER_NAME+" track event: "+t);var n=function(){};(i=i||n)()})});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added Track command to queue."),_btn.queueFunction(_btn.track,this,arguments);var o=function(){};i=i||o,i()}},trackPurchase:function(t,n,i,o){if(""==n&&(n={}),""==i&&(i={}),PurchaseDetails={orderTotal:t,shoppingCartItems:n,dataFields:i},window._bt)_bt.track("trackPurchase",PurchaseDetails,function(){if(_btn.log("Boomtrain track event: trackPurchase"),window.nudgespot&&e.isSet())nudgespot.track("purchase",PurchaseDetails,function(){nudgespot.identify(e.uid,{shoppingCartItems:[],shoppingCartItemsTotal:0},function(){_btn.log(PARTNER_NAME+" track event: purchase");var t=function(){};(o=o||t)()})});else{var t=function(){};o=o||t,o()}});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added TrackPurchase command to queue."),_btn.queueFunction(_btn.trackPurchase,this,arguments);var r=function(){};o=o||r,o()}},trackUpdateCart:function(t,n,i){if(1==arguments.length||!_btn.isNumeric(t)){n=t,t=0;for(var o=0;o<n.length;o++)t+=n[o].price*n[o].quantity;_btn.log("Calculated total: "+t)}if(""==n&&(n={}),window._bt)_bt.track("updateCart",{items:n,total:t},function(){if(_btn.log("Boomtrain track event: updateCart"),window.nudgespot&&e.isSet())nudgespot.track("update_cart",{items:n,total:t},function(){nudgespot.identify(e.uid,{shoppingCartItems:n,shoppingCartItemsTotal:t},function(){_btn.log(PARTNER_NAME+" track event: update_cart");var t=function(){};(i=i||t)()})});else{var o=function(){};i=i||o,i()}});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added UpdateCart command to queue."),_btn.queueFunction(_btn.trackUpdateCart,this,arguments);var r=function(){};i=i||r,i()}},updateUser:function(t,n){if(window._bt)_bt.person.set(t,function(){if(_btn.log("Updated user properties: "+JSON.stringify(t)),window.nudgespot&&e.isSet())nudgespot.identify(e.uid,t,function(){_btn.log(PARTNER_NAME+" updated user properties: "+JSON.stringify(t));var e=function(){};(n=n||e)()});else{var i=function(){};n=n||i,n()}});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added UpdateCart command to queue."),_btn.queueFunction(_btn.updateUser,this,arguments);var i=function(){};n=n||i,n()}},identify:function(t,n){if(t)if(window._bt)_bt.identify(t,function(){_btn.log("Boomtrain identify: "+t),window.nudgespot&&nudgespot.identify(e.uid,{app_member_id:t},function(){_btn.log("Nudgespot identify: "+t);var e=function(){};(n=n||e)()})});else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added Identify command to queue."),_btn.queueFunction(_btn.identify,this,arguments);var i=function(){};n=n||i,n()}else{this.err("identify","No uniqueId provided!");var i=function(){};n=n||i,n()}},trackAccountSignup:function(t,n,i){if(window._bt)""==t?this.err("trackAccountSignup","UID or Email address needed."):(e.uid=t,e.dataFields=n,_btn.setCookie("bt-uid",e.uid,365),e.isSet()?_btn.setupCurrentUser(e,function(){_btn.track("startedMembership",e.dataFields,function(){var t=function(){};(i=i||t)()})}):this.err("trackAccountSignup","Could not set UID or email address, are you sure it is valid?"));else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added TrackAccountSignup command to queue."),_btn.queueFunction(_btn.trackAccountSignup,this,arguments);var o=function(){};i=i||o,i()}},trackAccountCompleted:function(t,n,i){if(window._bt)""==t?this.err("trackAccountCompleted","UID or Email address needed."):(e.uid=t,e.dataFields=n,e.isSet()?_btn.track("completedMembership",e.dataFields,function(){var t=function(){};(i=i||t)()}):this.err("trackAccountCompleted","Could not set UID or email address, are you sure it is valid?"));else{_btn.log("Boomtrain & "+PARTNER_NAME+" libraries not loaded, added TrackAccountCompleted command to queue."),_btn.queueFunction(_btn.trackAccountCompleted,this,arguments);var o=function(){};i=i||o,i()}},trackAddCart:function(){},trackRemoveCart:function(){},trackShipped:function(){},trackReviewStarted:function(){},trackReviewCompleted:function(){},trackView:function(t){},extend:function(t){return _btn.each(u.call(arguments,1),function(n){if(n)for(var e in n)t[e]=n[e]}),t},each:function(t,n,e){if(null==t)return t;if(d&&t.forEach===d)t.forEach(n,e);else if(t.length===+t.length){for(var i=0,o=t.length;o>i;i++)if(n.call(e,t[i],i,t)===breaker)return}else for(var r=_btn.keys(t),i=0,o=r.length;o>i;i++)if(n.call(e,t[r[i]],r[i],t)===breaker)return;return t},keys:function(t){if(!_btn.isObject(t))return[];if(c)return c(t);var n=[];for(var e in t)_btn.has(t,e)&&n.push(e);return n},has:function(t,n){return s.call(t,n)},isObject:function(t){return t===Object(t)},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},setCookie:function(t,n,e){var i=new Date;i.setTime(i.getTime()+24*e*60*60*1e3);var o="expires="+i.toUTCString(),r=window.location.hostname.split(".").reverse(),a="domain=."+r[1]+"."+r[0],u="path=/;";document.cookie=t+"="+n+"; "+o+"; "+u+"; "+a},getCookie:function(t){for(var n=t+"=",e=document.cookie.split(";"),i=0;i<e.length;i++){for(var o=e[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(n))return o.substring(n.length,o.length)}return""},getParameterByName:function(t,n){n||(n=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var e=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)","i"),i=e.exec(n);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}},window._btn=new t}();var qsBtEmail=_btn.getParameterByName("bt_email");qsBtEmail&&(_btn.log("Email passed through querystring: "+qsBtEmail),_btn.setCookie("bt-email",qsBtEmail,365));
